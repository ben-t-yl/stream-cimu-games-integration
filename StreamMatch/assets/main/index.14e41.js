window.__require=function t(e,o,i){function n(r,a){if(!o[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var d=o[r]={exports:{}};e[r][0].call(d.exports,function(t){return n(e[r][1][t]||t)},d,d.exports,t,e,o,i)}return o[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<i.length;r++)n(i[r]);return n}({AStar:[function(t,e,o){"use strict";cc._RF.push(e,"47bbberHG5PkpxWybRprYUF","AStar");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0}),o.Grid=void 0;var n,s=cc._decorator,r=s.ccclass,a=(s.property,function(){function t(){this.x=0,this.y=0,this.f=0,this.g=0,this.h=0,this.parent=null,this.type=0}return t.prototype.clear=function(){this.f=0,this.g=0,this.h=0,this.parent=null},t}());o.Grid=a,function(t){t[t.NONE=0]="NONE",t[t.OBSTACLE=-1]="OBSTACLE",t[t.START=1]="START",t[t.END=2]="END"}(n||(n={}));var c=function(){function t(){this.is8dir=!1,this.path=[]}return t.prototype.setMapData=function(t){var e=this;t.forEach(function(t){e.gridsList[t.x][t.y].type=-1})},t.prototype.initMap=function(t,e){this.mapH=e-1,this.mapW=t-1,this.is8dir=!0,this.openList=[],this.closeList=[],this.path=[],this._cashpath={},this._history=!1,this.gridsList=new Array(this.mapW+1);for(var o=0;o<this.gridsList.length;o++)this.gridsList[o]=new Array(this.mapH+1);for(o=0;o<=this.mapW;o++)for(var i=0;i<=this.mapH;i++)this.addGrid(o,i,n.NONE)},t.prototype.addGrid=function(t,e,o){var i=new a;i.x=t,i.y=e,i.type=o,this.gridsList[t][e]=i},t.prototype._sortFunc=function(t,e){return t.f-e.f},t.prototype.generatePath=function(t){for(this.path.push(cc.v2(t.x,t.y));t.parent;)t=t.parent,this.path.push(cc.v2(t.x,t.y))},t.prototype.findPath=function(t,e){this.openList=[],this.closeList=[],this.path=[];var o=t,i=e,s="sx"+o.x+"sy"+o.y+"ex"+i.x+"ey"+i.y;if(this._history&&this._cashpath[s])return this.path=this._cashpath[s],!0;for(var r=0;r<=this.mapW;r++)for(var a=0;a<=this.mapH;a++)this.gridsList[r][a].clear(),this.gridsList[r][a].type!=n.START&&this.gridsList[r][a].type!=n.END||(this.gridsList[r][a].type=n.NONE);this.gridsList[o.x][o.y].type=n.START;var c=this.gridsList[o.x][o.y];if(this.gridsList[i.x][i.y].type=n.END,c.type==n.END)return this.path=[cc.v2(c.x,c.y)],!0;this.openList.push(c);for(var l=this.openList[0];this.openList.length>0&&l.type!=n.END;){if((l=this.openList[0]).type==n.END)return this.generatePath(l),s="sx"+o.x+"sy"+o.y+"ex"+i.x+"ey"+i.y,this._cashpath[s]=JSON.parse(JSON.stringify(this.path)),!0;for(var d=-1;d<=1;d++)for(var u=-1;u<=1;u++)if((0!=d||0!=u)&&(r=l.x+d,a=l.y+u,r>=0&&a>=0&&r<=this.mapW&&a<=this.mapH&&-1!=this.gridsList[r][a].type&&this.closeList.indexOf(this.gridsList[r][a])<0)){if(this.is8dir){if(-1==this.gridsList[r-d][a].type||-1==this.gridsList[r][a-u].type)continue}else if(Math.abs(d)==Math.abs(u))continue;var h=l.g+Math.sqrt(Math.pow(10*d,2)+Math.pow(10*u,2));(0==this.gridsList[r][a].g||this.gridsList[r][a].g>h)&&(this.gridsList[r][a].g=h,this.gridsList[r][a].parent=l),this.gridsList[r][a].h=Math.abs(i.x-r)+Math.abs(i.y-a),this.gridsList[r][a].f=this.gridsList[r][a].g+this.gridsList[r][a].h,this.openList.indexOf(this.gridsList[r][a])<0&&this.openList.push(this.gridsList[r][a])}if(this.closeList.push(l),this.openList.splice(this.openList.indexOf(l),1),this.openList.length<=0)return cc.log("find path failed."),!1;this.openList.sort(this._sortFunc)}},i([r],t)}();o.default=c,cc._RF.pop()},{}],AssetGrid:[function(t,e,o){"use strict";cc._RF.push(e,"f9114CBKcNATrxLtK4a0qyY","AssetGrid");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},n=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,s){function r(t){try{c(i.next(t))}catch(e){s(e)}}function a(t){try{c(i.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(r,a)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../Common/Utils"),r=t("./DragGrid"),a=t("./GridData"),{ccclass:c,property:l}=cc._decorator;let d=class extends cc.Component{constructor(){super(...arguments),this.sprite=null,this.down=!1,this.data=null,this.drag_node=null}init(t){return new Promise(e=>n(this,void 0,void 0,function*(){{let o=yield s.default.loadRemote(t.picUrl);o instanceof cc.Texture2D&&(this.sprite.spriteFrame=new cc.SpriteFrame(o),this.data=new a.default,this.data.id=t.id,this.data.url=t.photoUrl,this.data.texture=o),e(o)}}))}start(){this.node.on(cc.Node.EventType.TOUCH_START,t=>{this.down=!0,this.scheduleOnce(()=>{if(this.down){this.down=!1;let e=cc.instantiate(this.manager.drag_prefab),o=e.getComponent(r.default);o.data=this.data,o.init();let i=this.manager.drag_contain_node.convertToNodeSpaceAR(new cc.Vec3(t.getLocation().x,t.getLocation().y,0));e.setPosition(i),this.manager.drag_contain_node.addChild(e),this.manager.scrollView.enabled=!1,this.drag_node=e}},.3)}),this.node.on(cc.Node.EventType.TOUCH_MOVE,t=>{if(null!=this.drag_node){let e=this.manager.drag_contain_node.convertToNodeSpaceAR(new cc.Vec3(t.getLocation().x,t.getLocation().y,0));this.drag_node.setPosition(e)}}),this.node.on(cc.Node.EventType.TOUCH_END,t=>{this.down=!1,this.manager.scrollView.enabled=!0,null!=this.drag_node&&(this.drag_node.parent.removeChild(this.drag_node),this.manager.add_grid(new cc.Vec3(t.getLocation().x,t.getLocation().y,0),this.data),this.drag_node=null)}),this.node.on(cc.Node.EventType.TOUCH_CANCEL,t=>{this.down=!1,this.manager.scrollView.enabled=!0,null!=this.drag_node&&(this.drag_node.parent.removeChild(this.drag_node),this.manager.add_grid(new cc.Vec3(t.getLocation().x,t.getLocation().y,0),this.data),this.drag_node=null)})}};i([l(cc.Sprite)],d.prototype,"sprite",void 0),d=i([c],d),o.default=d,cc._RF.pop()},{"../Common/Utils":"Utils","./DragGrid":"DragGrid","./GridData":"GridData"}],CommHub:[function(t,e,o){"use strict";cc._RF.push(e,"b87449GmytDqZg9tH74DVpm","CommHub"),Object.defineProperty(o,"__esModule",{value:!0});const i=t("./Common/GameEvent"),n=t("./Common/Singleton"),s=t("./Tool/EventType");o.default=class extends n.default{constructor(){super();try{console.log("\u521d\u59cb\u5316\u4e2d\u8f6c\u7ad9"),window.sender.initParams=this.InitParams,window.sender.startGame=this.StartGame}catch(t){console.error(t)}}GameReady(){console.log("\u6267\u884c\u6e38\u620f\u51c6\u5907"),console.log("\u53d1\u9001\u6e38\u620f\u51c6\u5907"),window.parent.postMessage({kind:"[game]:is-ready",version:1},"*")}InitParams(t){i.default.Instance().dispatch(s.default.GameInit,t)}StartGame(){i.default.Instance().dispatch(s.default.GameStart)}GameEnded(t,e){console.log("\u53d1\u9001\u5206\u6570");let o={kind:"[game]:ended",version:1,scores:t,pairs:e};window.parent.postMessage(o,"*")}},cc._RF.pop()},{"./Common/GameEvent":"GameEvent","./Common/Singleton":"Singleton","./Tool/EventType":"EventType"}],DataBoard:[function(t,e,o){"use strict";cc._RF.push(e,"f8aef2N/J5I8IJJOVZi9g1H","DataBoard");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),s=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0}),window.DATABOARD=!0;var r=cc._decorator,a=r.ccclass,c=r.property,l=r.executeInEditMode,d=r.menu,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isOutlineBoxActive=!1,e._outlineBoxColor=new cc.Color(255*Math.random(),255*Math.random(),255*Math.random()),e._outlineBoxOpacity=100,e._isCollideBoxActive=!0,e._collideBoxColor=new cc.Color(255*Math.random(),255*Math.random(),255*Math.random()),e._collideBoxOpacity=100,e._isCustomLabelActive=!0,e.customComponentName="",e._customLabelString="x,y",e._customLabelOffset=cc.v2(0,100),e._customLabelColor=new cc.Color(255,255,0),e._customLabelSize=60,e._customLabelDigit=0,e.boardNode=null,e.outlineBoxNode=null,e.collideBoxNode=null,e.anchorPointNode=null,e.customLabelNode=null,e.customLabel=null,e.customLabelStringSplit=null,e.monitorComp=null,e}return n(e,t),Object.defineProperty(e.prototype,"isOutlineBoxActive",{get:function(){return this._isOutlineBoxActive},set:function(t){this._isOutlineBoxActive=t,this.outlineBoxNode.active=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineBoxColor",{get:function(){return this._outlineBoxColor},set:function(t){this._outlineBoxColor=t,this.outlineBoxNode.color=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"outlineBoxOpacity",{get:function(){return this._outlineBoxOpacity},set:function(t){this._outlineBoxOpacity=t,this.outlineBoxNode.opacity=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCollideBoxActive",{get:function(){return this._isCollideBoxActive},set:function(t){this._isCollideBoxActive=t,this.collideBoxNode.active=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collideBoxColor",{get:function(){return this._collideBoxColor},set:function(t){this._collideBoxColor=t,this.collideBoxNode.color=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collideBoxOpacity",{get:function(){return this._collideBoxOpacity},set:function(t){this._collideBoxOpacity=t,this.collideBoxNode.opacity=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCustomLabelActive",{get:function(){return this._isCustomLabelActive},set:function(t){this._isCustomLabelActive=t,this.customLabelNode.active=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customLabelString",{get:function(){return this._customLabelString},set:function(t){this._customLabelString=t,this.customLabelStringSplit=t.replace(/,|\uff0c/g,"_~_").replace(/:|\uff1a/g,"_!_").replace(/ /g,"_@_").replace(/_*\n_*/g,"_\n_").split("_")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customLabelOffset",{get:function(){return this._customLabelOffset},set:function(t){this._customLabelOffset=t,this.customLabelNode.x=t.x,this.customLabelNode.y=t.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customLabelColor",{get:function(){return this._customLabelColor},set:function(t){this._customLabelColor=t,this.customLabelNode.color=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customLabelSize",{get:function(){return this._customLabelSize},set:function(t){this._customLabelSize=t,this.customLabel.fontSize=t,this.customLabel.lineHeight=1.2*t,this.customLabelNode.getComponent(cc.LabelOutline).width=.1*t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customLabelDigit",{get:function(){return this._customLabelDigit},set:function(t){this._customLabelDigit=t},enumerable:!1,configurable:!0}),e.prototype.start=function(){if(this.boardNode=this.node.getChildByName("DataBoard"),window.DATABOARD){cc.isValid(this.boardNode)&&(this.boardNode.removeFromParent(),this.boardNode.destroy());var t=new cc.Texture2D;t.initWithData(new Uint8Array([255,255,255]),cc.Texture2D.PixelFormat.RGB888,1,1),this.boardNode=new cc.Node("DataBoard"),this.boardNode.setParent(this.node),this.boardNode.x=this.boardNode.y=0,this.boardNode.zIndex=cc.macro.MAX_ZINDEX,this.boardNode._objFlags|=cc.Object.Flags.HideInHierarchy,this.boardNode._objFlags|=cc.Object.Flags.LockedInEditor,this.outlineBoxNode=new cc.Node("OutlineBox"),this.outlineBoxNode.setParent(this.boardNode),this.outlineBoxNode.addComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t),this.outlineBoxNode.active=this.isOutlineBoxActive,this.outlineBoxNode.color=this.outlineBoxColor,this.outlineBoxNode.opacity=this.outlineBoxOpacity,this.collideBoxNode=new cc.Node("CollideBox"),this.collideBoxNode.setParent(this.boardNode),this.collideBoxNode.addComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t),this.collideBoxNode.active=this.isCollideBoxActive,this.collideBoxNode.color=this.collideBoxColor,this.collideBoxNode.opacity=this.collideBoxOpacity,this.anchorPointNode=new cc.Node("AnchorPoint"),this.anchorPointNode.setParent(this.boardNode),this.anchorPointNode.addComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t),this.anchorPointNode.color=cc.color(255,0,0),this.anchorPointNode.width=20,this.anchorPointNode.height=20,this.customLabelNode=new cc.Node("CustomLabel"),this.customLabelNode.setParent(this.boardNode),this.customLabel=this.customLabelNode.addComponent(cc.Label),this.customLabelNode.addComponent(cc.LabelOutline).color=cc.color(0,0,0),this.customLabelNode.active=this.isCustomLabelActive,this.customLabelString=this._customLabelString,this.customLabelNode.x=this.customLabelOffset.x,this.customLabelNode.y=this.customLabelOffset.y,this.customLabelNode.color=this.customLabelColor,this.customLabelSize=this._customLabelSize,this.updateAngle(),this.updateScale(),this.updateAnchor(),this.updateSize(),this.node.on(cc.Node.EventType.ROTATION_CHANGED,this.updateAngle,this),this.node.on(cc.Node.EventType.SCALE_CHANGED,this.updateScale,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.updateAnchor,this),this.node.on(cc.Node.EventType.SIZE_CHANGED,this.updateSize,this)}else this.destroy()},e.prototype.updateAngle=function(){this.collideBoxNode.angle=-this.node.angle,this.customLabelNode.angle=-this.node.angle},e.prototype.updateScale=function(){this.boardNode.scaleX=1/this.node.scaleX,this.boardNode.scaleY=1/this.node.scaleY,this.outlineBoxNode.scaleX=this.node.scaleX,this.outlineBoxNode.scaleY=this.node.scaleY,this.collideBoxNode.scaleX=this.node.scaleX,this.collideBoxNode.scaleY=this.node.scaleY},e.prototype.updateAnchor=function(){this.outlineBoxNode.anchorX=this.node.anchorX,this.outlineBoxNode.anchorY=this.node.anchorY,this.collideBoxNode.anchorX=this.node.anchorX,this.collideBoxNode.anchorY=this.node.anchorY},e.prototype.updateSize=function(){this.outlineBoxNode.width=this.node.width,this.outlineBoxNode.height=this.node.height,this.collideBoxNode.width=this.node.width,this.collideBoxNode.height=this.node.height},e.prototype.update=function(){if(this.isCustomLabelActive&&this.customLabelStringSplit){if(0!==this.customLabelOffset.x||0!==this.customLabelOffset.y){var t=-this.node.angle*Math.PI/180,e=Math.cos(t),o=Math.sin(t);this.customLabelNode.x=this.customLabelOffset.x*e-this.customLabelOffset.y*o,this.customLabelNode.y=this.customLabelOffset.x*o+this.customLabelOffset.y*e}var i="",n=this.customLabelStringSplit;!this.monitorComp&&this.customComponentName&&(this.monitorComp=this.node.getComponent(this.customComponentName));for(var s=0,r=n.length;s<r;++s){var a=null;switch(n[s]){case"wp":var c=this.node._worldMatrix.m;a=c[12].toFixed(this.customLabelDigit)+",\t"+c[13].toFixed(this.customLabelDigit);break;case"angle":a=this.node.angle.toFixed(this.customLabelDigit)+"\xb0";break;case"radian":a=(this.node.angle/180).toFixed(this.customLabelDigit)+"\u03c0";break;case"matrix":c=this.node._worldMatrix.m,a="";for(var l=0;l<4;++l){for(var d=0;d<4;++d){var u=c[4*d+l];a+=(u<0?"\t\t":"\t\t\t")+u.toFixed(this.customLabelDigit)}3!==l&&(a+="\n")}break;case"children":a="";for(var h=0,p=this.node.childrenCount;h<p;++h)a+="\t\t\t"+h+"\uff1a"+this.node.children[h].name,h!==p-1&&(a+="\n");break;case"~":a=",\t";break;case"!":a=":\t";break;case"@":a="\t\t";break;default:"number"==typeof(a=void 0!==this.node[n[s]]?this.node[n[s]]:n[s].startsWith("#")&&null!==this.monitorComp?this.parseString(n[s].substring(1)):n[s])?a=a.toFixed(this.customLabelDigit):a.name&&(a=a.name)}i+=a}this.customLabel.string=i}},e.prototype.parseString=function(t){var e=t.split("."),o=this.monitorComp[e[0]];void 0===o&&(o="#"+e[0]);for(var i=1,n=e.length;i<n;++i){if(void 0===o[e[i]])return(o.name?o.name:o)+"."+e[i];o=o[e[i]]}return o},e.prototype.onDestroy=function(){cc.isValid(this.boardNode)&&(this.boardNode.removeFromParent(),this.boardNode.destroy()),this.node.targetOff(this)},s([c],e.prototype,"_isOutlineBoxActive",void 0),s([c({displayName:!1,tooltip:!1})],e.prototype,"isOutlineBoxActive",null),s([c],e.prototype,"_outlineBoxColor",void 0),s([c({displayName:!1,visible:function(){return this.isOutlineBoxActive}})],e.prototype,"outlineBoxColor",null),s([c],e.prototype,"_outlineBoxOpacity",void 0),s([c({min:0,max:255,step:1,slide:!0,displayName:!1,visible:function(){return this.isOutlineBoxActive}})],e.prototype,"outlineBoxOpacity",null),s([c],e.prototype,"_isCollideBoxActive",void 0),s([c({displayName:!1,tooltip:!1})],e.prototype,"isCollideBoxActive",null),s([c],e.prototype,"_collideBoxColor",void 0),s([c({displayName:!1,visible:function(){return this.isCollideBoxActive}})],e.prototype,"collideBoxColor",null),s([c],e.prototype,"_collideBoxOpacity",void 0),s([c({min:0,max:255,step:1,slide:!0,displayName:!1,visible:function(){return this.isCollideBoxActive}})],e.prototype,"collideBoxOpacity",null),s([c],e.prototype,"_isCustomLabelActive",void 0),s([c({displayName:!1,tooltip:!1})],e.prototype,"isCustomLabelActive",null),s([c({displayName:!1,tooltip:!1,visible:function(){return this.isCustomLabelActive}})],e.prototype,"customComponentName",void 0),s([c],e.prototype,"_customLabelString",void 0),s([c({multiline:!0,displayName:!1,tooltip:!1,visible:function(){return this.isCustomLabelActive}})],e.prototype,"customLabelString",null),s([c],e.prototype,"_customLabelOffset",void 0),s([c({displayName:!1,visible:function(){return this.isCustomLabelActive}})],e.prototype,"customLabelOffset",null),s([c],e.prototype,"_customLabelColor",void 0),s([c({displayName:!1,visible:function(){return this.isCustomLabelActive}})],e.prototype,"customLabelColor",null),s([c],e.prototype,"_customLabelSize",void 0),s([c({displayName:!1,visible:function(){return this.isCustomLabelActive}})],e.prototype,"customLabelSize",null),s([c],e.prototype,"_customLabelDigit",void 0),s([c({min:0,max:10,step:1,slide:!0,displayName:!1,visible:function(){return this.isCustomLabelActive}})],e.prototype,"customLabelDigit",null),s([a,l,d("Comp/DataBoard")],e)}(cc.Component);o.default=u,cc._RF.pop()},{}],DragGrid:[function(t,e,o){"use strict";cc._RF.push(e,"4be68gZWOhOTpJjlsbPhRix","DragGrid");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),s=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});var r=cc._decorator,a=r.ccclass,c=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e.sprite=null,e}return n(e,t),e.prototype.init=function(){this.sprite.spriteFrame=new cc.SpriteFrame(this.data.texture)},e.prototype.start=function(){this.node.on(cc.Node.EventType.TOUCH_START,function(){}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(){}),this.node.on(cc.Node.EventType.TOUCH_END,function(){}),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){})},s([c(cc.Sprite)],e.prototype,"sprite",void 0),s([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],EditGrid:[function(t,e,o){"use strict";cc._RF.push(e,"97927Rz1t9N8690X4Ikouwt","EditGrid");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},n=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,s){function r(t){try{c(i.next(t))}catch(e){s(e)}}function a(t){try{c(i.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(r,a)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./GridData"),{ccclass:r,property:a}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.sprite=null,this.data=null,this.index=0,this.id=-1}start(){}init(t){return new Promise(e=>n(this,void 0,void 0,function*(){{let o=yield this.loadRemote(t.photoUrl);o instanceof cc.Texture2D&&(this.sprite.node.active=!0,this.sprite.spriteFrame=new cc.SpriteFrame(o),this.data=new s.default,this.data.url=t.photoUrl,this.data.texture=o),e(o)}}))}loadRemote(t){return new Promise((e,o)=>{cc.assetManager.loadRemote(t,function(t,i){if(t)return cc.error(t.message||t),void o(t);e(i)})})}change(){this.sprite.node.active=!0,this.sprite.spriteFrame=new cc.SpriteFrame(this.data.texture)}};i([a(cc.Sprite)],c.prototype,"sprite",void 0),c=i([r],c),o.default=c,cc._RF.pop()},{"./GridData":"GridData"}],EventType:[function(t,e,o){"use strict";cc._RF.push(e,"99986sv4tpBtaTEbxmmxb7e","EventType"),Object.defineProperty(o,"__esModule",{value:!0});class i{}o.default=i,i.GameInit="GameInit",i.GameStart="GameStart",i.Logined="Logined",cc._RF.pop()},{}],GameEvent:[function(t,e,o){"use strict";cc._RF.push(e,"bc7a5NQWO5IAa0GhY3uZeE7","GameEvent");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.eventHash={},e.ower=null,e.type=null,e.callback=null,e}return n(e,t),e.prototype.clearAll=function(){this.eventHash={}},e.prototype.register=function(t,e,o){var i={};i.ower=t,i.type=e,i.callback=o,this.eventHash.hasOwnProperty(e)||(this.eventHash[e]=[]),this.eventHash[e].push(i)},e.prototype.unregister=function(t,e){var o=this.eventHash[e];o&&o.length>0&&o.forEach(function(i,n){i.ower===t&&i.type===e&&o.splice(n,1)})},e.prototype.dispatch=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var i=this.eventHash[t];if(i&&i.length>0)for(var n in i){var s=i[n];s.callback&&(s.callback=s.callback.bind(s.ower),s.callback.apply(s,e))}},e}(t("./Singleton").default);o.default=s,cc._RF.pop()},{"./Singleton":"Singleton"}],Game:[function(t,e,o){"use strict";cc._RF.push(e,"f1adf1GFJdDHb8j21A2Z43r","Game");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},n=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,s){function r(t){try{c(i.next(t))}catch(e){s(e)}}function a(t){try{c(i.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(r,a)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("./CommHub"),r=t("./Common/GameEvent"),a=t("./Common/HTTP"),c=t("./Common/Utils"),l=t("./Grid"),d=t("./Tool/EventType"),u=t("./Tool/HTTP_API"),{ccclass:h,property:p}=cc._decorator;let f=class extends cc.Component{constructor(){super(...arguments),this.reward_time=60,this.drop_time=60,this.pairs_label=null,this.incorrect_label=null,this.drop_time_label=null,this.reward_time_label=null,this.reward_time_node=null,this.grids_node=null,this.start_node=null,this.end_node=null,this.grids_json=null,this.game_data=null,this.grids_data=null,this.status=-1,this.can_play=!1,this.level=0,this.single=!1,this.curGrid=null,this.pairs_count=0,this.incorrect_count=0,this.bar_length=314}start(){for(let t of this.grids_node.children)t.getComponent(l.default).game=this;r.default.Instance().register(this,d.default.GameInit,t=>{console.log("\u63a5\u53d7\u5916\u90e8\u53c2\u6570"),this.game_data=t,this.init()}),r.default.Instance().register(this,d.default.GameStart,()=>{console.log("\u63a5\u53d7\u6e38\u620f\u5f00\u59cb"),this.can_play=!0,0==this.status&&this.startGame()}),s.default.Instance().GameReady()}init(){return n(this,void 0,void 0,function*(){this.drop_time=this.game_data.gameDurationInSeconds,this.level=this.game_data.gameParams.level;let t={gradeDifficulty:this.level};a.default.url=" https://stream-api.342games.com/api/";let e=yield a.default.getRequestAsync(u.default.GameConfig,t);if(200==e.code){if(this.grids_data=e.data,null!=this.grids_data){let t=0;for(let e of this.grids_data){let o=yield c.default.loadRemote(e.picUrl);if(o instanceof cc.Texture2D)for(let i of this.grids_node.children){let n=i.getComponent(l.default);if(n.index==t){n.id=e.id,n.imgId=e.picUrlId,n.img.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(o),t++;break}}}}this.pairs_label.string=0,this.incorrect_label.string=0,this.status=0,this.can_play&&this.startGame()}else console.error(e)})}startGame(){this.setTime(),this.scheduleOnce(()=>{this.start_time=new Date,this.start_node.active=!1,this.status=1,this.schedule(this.execTimer,1)},1)}execTimer(){3!=this.status?(this.reward_time>0?this.reward_time--:this.reward_time=0,this.drop_time>0?this.drop_time--:this.drop_time=0,this.setTime(),(this.drop_time<=0||this.reward_time<=0)&&(this.status=3,this.calcScore())):this.unschedule(this.execTimer)}setTime(){let t=Math.floor(this.drop_time/60),e=this.drop_time%60,o=`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`;this.drop_time_label.string=o}checkGrid(t){this.single?(this.single=!1,this.curGrid.imgId==t.imgId?(this.pairs_count++,this.pairs_label.string=this.pairs_count,this.curGrid.blink(),t.blink(),this.scheduleOnce(()=>{5==this.pairs_count&&this.autoTurn(),this.status=1,this.curGrid=null},1)):(this.incorrect_count++,this.incorrect_label.string=this.incorrect_count,this.scheduleOnce(()=>{this.curGrid.reset(),t.reset(),this.curGrid=null},.3))):(this.single=!0,this.status=1,this.curGrid=t)}autoTurn(){for(let t of this.grids_node.children){let e=t.getComponent(l.default);e.flag||e.autoTurn()}this.scheduleOnce(()=>{this.pairs_count++,this.pairs_label.string=this.pairs_count,this.status=3,this.calcScore()},1.3)}calcScore(){let t=(new Date).getTime()-this.start_time.getTime(),e=100*this.pairs_count+(6e4-t)/6e4*600-20*this.incorrect_count;console.log(`score:${e}`),e=e>0?e:0,e=Math.floor(e),this.scheduleOnce(()=>{s.default.Instance().GameEnded(e,this.pairs_count),this.end_node.active=!0},1)}update(t){if(1==this.status||2==this.status){let t=6e4-((new Date).getTime()-this.start_time.getTime());t=t>0?t:0,this.reward_time_node.width=t/6e4*this.bar_length;let e=Math.floor(t/1e3),o=Math.floor(t%1e3/10),i=`${e.toFixed(0).padStart(2,"0")}'${o.toFixed(0).padStart(2,"0")}''`;this.reward_time_label.string=i}}};i([p(cc.Label)],f.prototype,"pairs_label",void 0),i([p(cc.Label)],f.prototype,"incorrect_label",void 0),i([p(cc.Label)],f.prototype,"drop_time_label",void 0),i([p(cc.Label)],f.prototype,"reward_time_label",void 0),i([p(cc.Node)],f.prototype,"reward_time_node",void 0),i([p(cc.Node)],f.prototype,"grids_node",void 0),i([p(cc.Node)],f.prototype,"start_node",void 0),i([p(cc.Node)],f.prototype,"end_node",void 0),i([p(cc.JsonAsset)],f.prototype,"grids_json",void 0),f=i([h],f),o.default=f,cc._RF.pop()},{"./CommHub":"CommHub","./Common/GameEvent":"GameEvent","./Common/HTTP":"HTTP","./Common/Utils":"Utils","./Grid":"Grid","./Tool/EventType":"EventType","./Tool/HTTP_API":"HTTP_API"}],GridData:[function(t,e,o){"use strict";cc._RF.push(e,"ddaebrw3x5AE629NnfdDtEm","GridData"),Object.defineProperty(o,"__esModule",{value:!0});o.default=function(){},cc._RF.pop()},{}],Grid:[function(t,e,o){"use strict";cc._RF.push(e,"a0640jsilVG6pBEjZGl11Ii","Grid");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:n,property:s}=cc._decorator;let r=class extends cc.Component{constructor(){super(...arguments),this.img=null,this.front=null,this.back=null,this.light_node=null,this.index=-1,this.id=-1,this.imgId=-1,this.flag=!1}start(){this.node.on(cc.Node.EventType.TOUCH_START,()=>{1!=this.game.status||this.flag||(this.game.status=2,this.flag=!0,cc.tween(this.node).to(.16,{scaleX:0,scaleY:1.2}).call(()=>{this.node.getComponent(cc.Sprite).spriteFrame=this.front,this.img.active=!0}).to(.16,{scaleX:1,scaleY:1}).call(()=>{this.game.checkGrid(this)}).start())})}reset(){cc.tween(this.node).to(.16,{scaleX:0,scaleY:1.2}).call(()=>{this.node.getComponent(cc.Sprite).spriteFrame=this.back,this.img.active=!1}).to(.16,{scaleX:1,scaleY:1}).call(()=>{this.flag=!1,this.game.status=1}).start()}autoTurn(){this.flag=!0,cc.tween(this.node).to(.16,{scaleX:0,scaleY:1.2}).call(()=>{this.node.getComponent(cc.Sprite).spriteFrame=this.front,this.img.active=!0}).to(.16,{scaleX:1,scaleY:1}).call(()=>{this.blink()}).start()}blink(){this.light_node.active=!0,cc.tween(this.light_node).blink(1,3).call(()=>{this.light_node.active=!1}).start()}};i([s(cc.Node)],r.prototype,"img",void 0),i([s(cc.SpriteFrame)],r.prototype,"front",void 0),i([s(cc.SpriteFrame)],r.prototype,"back",void 0),i([s(cc.Node)],r.prototype,"light_node",void 0),i([s(cc.Integer)],r.prototype,"index",void 0),r=i([n],r),o.default=r,cc._RF.pop()},{}],HTTP_API:[function(t,e,o){"use strict";cc._RF.push(e,"fb848tKBSBBT5Zr7N1Hdp53","HTTP_API"),Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:i,property:n}=cc._decorator;class s{}o.default=s,s.Login="admin/admin/login",s.AssetList="admin/gamePhoto/getList",s.GameConfig="app/game/start",s.UpdateConfig="admin/gameConfig/update",s.AddConfig="admin/gameConfig/add",cc._RF.pop()},{}],HTTP:[function(t,e,o){"use strict";cc._RF.push(e,"76a85v8l/hB4bp2iBJovNVj","HTTP"),Object.defineProperty(o,"__esModule",{value:!0});class i{static getRequest(t,e,o,n=null,s=null,r=null){let a=new XMLHttpRequest;const c=[];for(const i in e)c.push(`${i}=${encodeURIComponent(e[i])}`);const l=c.join("&"),d=`${i.url}${t}${e?`?${l}`:""}`;return cc.log(d),a.open("GET",d,!0),null!=s&&a.setRequestHeader("Authorization",`Bearer ${s}`),a.onload=()=>{if(a.status>=200&&a.status<300||304===a.status)try{const e=JSON.parse(a.responseText);o(e)}catch(t){cc.log(t),n&&n(t)}else a.abort(),cc.log(new Error(`Failed with status ${a.status}`)),n&&n(new Error(`Failed with status ${a.status}`))},a.send(),a}static getRequestAsync(t,e,o=null,n=6e4){return new Promise((s,r)=>{const a=new XMLHttpRequest,c=[];for(const t in e)c.push(`${t}=${encodeURIComponent(e[t])}`);const l=c.join("&"),d=`${i.url}${t}${e?`?${l}`:""}`;cc.log(d),a.open("GET",d,!0),a.timeout=n,null!=o&&a.setRequestHeader("token",o),a.onload=()=>{if(a.status>=200&&a.status<300||304===a.status)try{const e=JSON.parse(a.responseText);s(e)}catch(t){r(t)}else a.abort(),r(new Error(`Failed with status ${a.status}`))},a.ontimeout=t=>{r(new Error(`Timeout: ${t}`))},a.onabort=t=>{r(new Error(`Aborted: ${t}`))},a.onerror=t=>{console.log(t),r(new Error(`Error: ${t}`))},a.send()})}static postRequest(t,e,o,n=null,s=null,r=!1){var a=new XMLHttpRequest,c=i.url+t;return console.log(c),a.open("POST",c),a.setRequestHeader("Access-Control-Allow-Origin","*"),a.setRequestHeader("Access-Control-Allow-Methods","GET, POST"),a.setRequestHeader("Access-Control-Allow-Headers","x-requested-with,content-type"),r||a.setRequestHeader("Content-Type","application/json"),null!=s&&a.setRequestHeader("Authorization",`Bearer ${s}`),a.onload=()=>{if(a.status>=200&&a.status<300||304==a.status){console.log(a.responseText);var t=JSON.parse(a.responseText);o&&o(t)}else a.abort()},a.ontimeout=t=>{cc.error(t),n&&n(t)},a.onabort=t=>{cc.error(t),n&&n(t)},a.onerror=t=>{cc.error(t),n&&n(t)},r?a.send(e):a.send(JSON.stringify(e)),a}static postRequestAsync(t,e,o,n){return new Promise((s,r)=>{const a=new XMLHttpRequest,c=i.url+t;cc.log(c),a.open("POST",c),a.setRequestHeader("Access-Control-Allow-Origin","*"),a.setRequestHeader("Access-Control-Allow-Methods","GET, POST"),a.setRequestHeader("Access-Control-Allow-Headers","x-requested-with,content-type"),null!=o&&a.setRequestHeader("Authorization",`Bearer ${o}`),a.onload=()=>{if(a.status>=200&&a.status<300||304==a.status){const t=JSON.parse(a.responseText);s(t)}else r(new Error("Request failed"))},a.ontimeout=()=>{r(new Error("Request timed out"))},a.onerror=()=>{r(new Error("Network error"))},n?a.send(e):(a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(e)))})}}o.default=i,i.url="",cc._RF.pop()},{}],Init:[function(t,e,o){"use strict";cc._RF.push(e,"4506b2MVkdJw5BcMmJIiE39","Init");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});const n=t("./Grid"),{ccclass:s,executeInEditMode:r,property:a}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.grid_fab=null}start(){console.log("start");for(let t=0;t<12;t++){let e=cc.instantiate(this.grid_fab);e.getComponent(n.default).index=t,this.node.addChild(e)}}onDestroy(){this.node.clear(),super.destroy()}};i([a(cc.Prefab)],c.prototype,"grid_fab",void 0),c=i([s,r],c),o.default=c,cc._RF.pop()},{"./Grid":"Grid"}],Login:[function(t,e,o){"use strict";cc._RF.push(e,"a228bNg1dNKV5hMtC4z7BkG","Login");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},n=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,s){function r(t){try{c(i.next(t))}catch(e){s(e)}}function a(t){try{c(i.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(r,a)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../Common/GameEvent"),r=t("../Common/HTTP"),a=t("./EventType"),c=t("./HTTP_API"),l=t("./ToolData"),{ccclass:d,property:u}=cc._decorator;let h=class extends cc.Component{constructor(){super(...arguments),this.flag=!1,this.msg_node=null}start(){r.default.url="http://47.97.156.6:8082/api/"}btn_login(){this.flag||(this.flag=!0,this.login())}login(){return n(this,void 0,void 0,function*(){r.default.getRequest(c.default.Login,{userNumber:"admin",password:"123456"},t=>{l.default.LoginToken=t.data,this.node.active=!1,s.default.Instance().dispatch(a.default.Logined)},()=>{this.msg_node.active=!0})})}};i([u(cc.Node)],h.prototype,"msg_node",void 0),h=i([d],h),o.default=h,cc._RF.pop()},{"../Common/GameEvent":"GameEvent","../Common/HTTP":"HTTP","./EventType":"EventType","./HTTP_API":"HTTP_API","./ToolData":"ToolData"}],Singleton:[function(t,e,o){"use strict";cc._RF.push(e,"4b55fg7zC1DDpE89UWaabze","Singleton"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.Instance=function(){return this.instance||(this.instance=new this),this.instance},t}();o.default=i,cc._RF.pop()},{}],Timer:[function(t,e,o){"use strict";cc._RF.push(e,"2bfbbyqfulH46xAXAB9wBHK","Timer");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});const n=t("./GameEvent"),{ccclass:s,property:r}=cc._decorator;let a=class extends cc.Component{constructor(){super(...arguments),this.lbl=null,this.txt="",this.count_number=0,this.stop=!1}start(){this.timer()}timer(){this.scheduleOnce(()=>{this.stop||(this.txt.length>0?this.count_number<10?this.lbl.string=this.txt+this.count_number.toString():this.lbl.string=this.txt+" "+this.count_number.toString():this.lbl.string=this.count_number.toString(),this.count_number--,this.count_number>=0?this.timer():(this.timerStop(),n.default.Instance().dispatch("timer_over")))},1)}timerStop(){this.stop=!0}};i([r(cc.Label)],a.prototype,"lbl",void 0),i([r(cc.String)],a.prototype,"txt",void 0),i([r(cc.Integer)],a.prototype,"count_number",void 0),a=i([s],a),o.default=a,cc._RF.pop()},{"./GameEvent":"GameEvent"}],ToolData:[function(t,e,o){"use strict";cc._RF.push(e,"57889yrmalIjYM9dSJDt7IK","ToolData"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.LoginToken="",t}();o.default=i,cc._RF.pop()},{}],Tool:[function(t,e,o){"use strict";cc._RF.push(e,"1bbb7W2Gb5AH5n35OoFqoQc","Tool");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r},n=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,s){function r(t){try{c(i.next(t))}catch(e){s(e)}}function a(t){try{c(i.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(r,a)}c((i=i.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const s=t("../Common/GameEvent"),r=t("../Common/HTTP"),a=t("./AssetGrid"),c=t("./EditGrid"),l=t("./EventType"),d=t("./HTTP_API"),u=t("./ToolData"),{ccclass:h,property:p}=cc._decorator;let f=class extends cc.Component{constructor(){super(...arguments),this.asset_prefab=null,this.drag_prefab=null,this.edit_prefab=null,this.asset_contain_node=null,this.drag_contain_node=null,this.save_btn=null,this.grids_node=null,this.msg_lab=null,this.scrollView=null,this.status=0}start(){s.default.Instance().register(this,l.default.Logined,()=>{r.default.getRequest(d.default.AssetList,null,t=>n(this,void 0,void 0,function*(){for(let e of t.data){let t=cc.instantiate(this.asset_prefab),o=t.getComponent(a.default);yield o.init(e),o.manager=this,this.asset_contain_node.addChild(t)}for(let t=0;t<12;t++){let e=cc.instantiate(this.edit_prefab);e.getComponent(c.default).index=t,this.grids_node.addChild(e)}this.save_btn.active=!0,this.status=1,r.default.getRequest(d.default.GameConfig,null,t=>n(this,void 0,void 0,function*(){if(200==t.code)for(let e of t.data){let t=e.rowNum-1+3*(e.colNum-1);for(let o of this.grids_node.children){let i=o.getComponent(c.default);if(i.index==t){i.id=e.id,yield i.init(e);break}}}}),()=>{},u.default.LoginToken)}),()=>{},u.default.LoginToken)})}add_grid(t,e){let o=this.grids_node.convertToNodeSpaceAR(t);for(let i of this.grids_node.children)if(o.x>i.getPosition().x-30&&o.x<i.getPosition().x+30&&o.y>i.getPosition().y-30&&o.y<i.getPosition().y+30){let t=i.getComponent(c.default);t.data=e,t.change();break}}save_btn_click(){return n(this,void 0,void 0,function*(){for(let t of this.grids_node.children){let e=t.getComponent(c.default),o={};o.colNum=e.index/3+1,o.rowNum=e.index%3+1,o.picUrl=e.data.url,-1==e.id?yield r.default.postRequestAsync(d.default.AddConfig,o,u.default.LoginToken,!1):(o.id=e.id,yield r.default.postRequestAsync(d.default.UpdateConfig,o,u.default.LoginToken,!1))}})}checkData(){let t=new Map;for(let e of this.grids_node.children){let o=e.getComponent(c.default);if(null==o.data)return this.msg_lab.string="Data not completed",!1;{let e=t.get(o.data.id);e?e.push(o.data.id):((e=new Array).push(o.data.id),t.set(o.data.id,e))}}for(let e of t.values())if(e.length%2>0)return this.msg_lab.string="Data not pairs",!1;return!0}};i([p(cc.Prefab)],f.prototype,"asset_prefab",void 0),i([p(cc.Prefab)],f.prototype,"drag_prefab",void 0),i([p(cc.Prefab)],f.prototype,"edit_prefab",void 0),i([p(cc.Node)],f.prototype,"asset_contain_node",void 0),i([p(cc.Node)],f.prototype,"drag_contain_node",void 0),i([p(cc.Node)],f.prototype,"save_btn",void 0),i([p(cc.Node)],f.prototype,"grids_node",void 0),i([p(cc.Label)],f.prototype,"msg_lab",void 0),i([p(cc.ScrollView)],f.prototype,"scrollView",void 0),f=i([h],f),o.default=f,cc._RF.pop()},{"../Common/GameEvent":"GameEvent","../Common/HTTP":"HTTP","./AssetGrid":"AssetGrid","./EditGrid":"EditGrid","./EventType":"EventType","./HTTP_API":"HTTP_API","./ToolData":"ToolData"}],Utils:[function(t,e,o){"use strict";cc._RF.push(e,"c8b8faX3mdEeZ921/dhz78y","Utils");var i=this&&this.__decorate||function(t,e,o,i){var n,s=arguments.length,r=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(s<3?n(r):s>3?n(e,o,r):n(e,o))||r);return s>3&&r&&Object.defineProperty(e,o,r),r};Object.defineProperty(o,"__esModule",{value:!0});const{ccclass:n,property:s}=cc._decorator;let r=class{static getRandom(t,e){return Math.random()*(e-t)+t}static getRandomInt(t,e){return e++,Math.floor(Math.random()*(e-t))+t}static loadRemote(t){return new Promise((e,o)=>{cc.assetManager.loadRemote(t,function(t,i){if(t)return cc.error(t.message||t),void o(t);e(i)})})}static shuffleArray(t){for(let e=t.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1));[t[e],t[o]]=[t[o],t[e]]}return t}static bubbleSort(t){for(let e=0;e<t.length-1;e++)for(let o=0;o<t.length-1-e;o++)if(t[o]>t[o+1]){let e=t[o];t[o]=t[o+1],t[o+1]=e}return t}};r=i([n],r),o.default=r,cc._RF.pop()},{}]},{},["CommHub","AStar","DataBoard","GameEvent","HTTP","Singleton","Timer","Utils","Game","Grid","Init","AssetGrid","DragGrid","EditGrid","EventType","GridData","HTTP_API","Login","Tool","ToolData"]);